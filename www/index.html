<html>
<head>
    <meta charset="utf-8">
    <title>Mocha Tests</title>
    <link href="%%LIB_BASE_URL%%/mocha/mocha.css" rel="stylesheet" />
</head>
<body>
    <div id="mocha"></div>

    <script src="%%LIB_BASE_URL%%/jquery/dist/jquery.js"></script>
    <script src="%%LIB_BASE_URL%%/chai/chai.js"></script>
    <script src="%%LIB_BASE_URL%%/mocha/mocha.js"></script>

    <script>
        mocha.setup('bdd');
    </script>

  <script>
%%TESTS%%
  </script>

<script>
    mocha.checkLeaks();
    mocha.globals(['jQuery']);
    mocha.run()
        .on('error', function (err) {
            console.error(err);
        })
        .on('end', function () {
            $.ajax({
                type: "POST",
                url: "%%STOP_URL%%",
                data: JSON.stringify({
                    "suite": "%%SUITE%%",
                    "stats": this.stats
                }),
                headers: {
                    "Accept": "application/json; charset=utf-8",                     
                    "Content-Type": "application/json; charset=utf-8"
                },
                dataType: "json"
            });
        });
  </script>
</body>
</html>